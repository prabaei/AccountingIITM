@model Accounting.data.Database.Transaction
@{
    ViewBag.Title = "Index";
}

@functions{
    string datestr(DateTime? dt)
    {
        if (dt != null)
        {
            DateTime tt = Convert.ToDateTime(dt);
            return tt.ToShortDateString();
        }
        return "";
    }
}

@*<h2> Transaction </h2>*@
<link href="~/Content/awsomeFontFamily/css/font-awesome.min.css" rel="stylesheet" />
<script src="~/scripts/Account/AccountCommon.js"></script>

@using (Html.BeginForm("TransactionPost", "Trans", FormMethod.Post, new { id = "TransactionForm" }))
{

    <br />
    <br />


    @*hidden fields*@
    <input type="hidden" id="hiddenstate" value="@Request.QueryString["state"]" />
    <input type="hidden" id="hiddenAccountNO" value="" />
    <input type="hidden" id="hiddenINSTID" name="INSTID" />
    <input type="hidden" id="hiddenProjectNO" name="ProjectNo" />
    <input type="hidden" id="hiddenProjectStartdate" />
    <input type="hidden" id="hiddenComitNO" />
    <input type="hidden" id="hiddenVoucherNO" />

    @Html.HiddenFor(m => m.Head, new { id = "hiddenHead" })
    @Html.HiddenFor(m => m.Description, new { id = "hiddenDisc" })
    @Html.HiddenFor(m => m.ProjectType, new { id = "hiddenprojtype" })

    <input type="hidden" id="hiddenDisc" />

    @Html.HiddenFor(m => m.TransNO, new { id = "TransNO", name = "TransNO" })

    @Html.HiddenFor(m => m.projtype, new { @id = "hidprojtype" })

    <div class="panel panel-default">
        <div class="panel-heading">
            @*Transaction NO : <label id="idtransno"></label>*@
            <div style="text-align:right">
                <a class="btn btn-info" href="@Url.Action("Index","Trans",new { area="" })">New</a>
            </div>
        </div>
        <div class="panel-body" style="">
            <div class="row" style="height:100%">
                <div class="col-lg-4">
                    <div class="panel panel-info" style="font-size:smaller">
                        <div class="panel-heading">
                            Recent Transaction
                        </div>
                        <div id="" class="panel-body">
                            <table class="table table-striped">
                                <tr>
                                    <td>Date</td>
                                    <td>Amount</td>
                                    <td>Type</td>
                                </tr>
                                <tbody>
                                    @foreach (var temp in Model.recentHistory)
                                    {
                                        <tr>
                                            <td>@datestr(temp.Date)</td>
                                            <td>@temp.amount </td>
                                            <td>@temp.VoucherType </td>
                                        </tr>
                                    }
                                </tbody>

                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.CheckBoxFor(m => m.engageFilterStr, new { @id = "filterbool" })@Html.Label("Search DISC as")
                            <div class="" style="max-width: 280px;">
                                @Html.TextBoxFor(m => m.filterStr, new { @style = "width:300px", @id = "filterstring", @class = "form-control" })
                            </div>
                        </div>
                    </div>
                    @*<div class="panel panel-info " style="font-size:smaller">
                            <div class="panel-heading">
                                Project Details
                            </div>
                            <div id="ProjectDetail" class="panel-body" style="display:none">
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("Coordinator Name")

                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="NAME"></label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("Title")
                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="TITLE"></label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("Start Date")
                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="STARTDATE"></label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("Close Date")
                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="CLOSEDATE"></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-info"  style="font-size:smaller">
                            <div class="panel-heading">
                                Voucher Details
                            </div>
                            <div id="VouDetails" class="panel-body" style="display:none">

                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("HEAD")

                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="vdHEAD"></label>
                                    </div>
                                </div>
                                @*<div class="row">
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            @Html.Label("Discription")
                                        </div>
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            <label id="vdDisc"></label>
                                        </div>
                                    </div>
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("PO")
                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="vdPO"></label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        @Html.Label("PART")
                                    </div>
                                    <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                        <label id="vdPART"></label>
                                    </div>
                                </div>
                                <div class="row">
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            @Html.Label("Amount")
                                        </div>
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            <label id="vdAmt"></label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            @Html.Label("CQNO")
                                        </div>
                                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                                            <label id="vdCQNO"></label>
                                        </div>
                                    </div>
                            </div>
                        </div>*@
                </div>
                <div class="col-lg-8">
                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Coordinator Name")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="idInstid" oninput="enterinst()" type="text" placeholder="Institute Id" class="form-control" style="max-width:280px" />*@
                                @Html.TextBoxFor(m => m.CoordinatorName, new { id = "coordname", oninput = "coordnameinp()", placeholder = "Coordinator Name", style = "max-width:280px", @class = "form-control" })
                                <span class="input-group-addon" aria-hidden="true" id="basic-addon2"><i id="coordnameicon" class="glyphicon glyphicon-search"></i><img id="coordnameimg" src="~/Content/Images/loading.gif" width="20" style="display:none" /></span>
                            </div>
                            <label id="ercoordname" style="color:red"></label>
                        </div>
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("AccountNO")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="idInstid" oninput="enterinst()" type="text" placeholder="Institute Id" class="form-control" style="max-width:280px" />*@
                                @Html.TextBoxFor(m => m.BankAccountNO, new { id = "bankaccno", oninput = "bankaccnoinp()", placeholder = "Account NO", style = "max-width:280px", @class = "form-control" })
                                <span class="input-group-addon" aria-hidden="true" id="basic-addon2"><i id="accountnoicon" class="glyphicon glyphicon-search"></i><img id="accimg" src="~/Content/Images/loading.gif" width="20" style="display:none" /></span>
                            </div>
                            <label id="erAccountno" style="color:red"></label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Institure ID")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="idInstid" oninput="enterinst()" type="text" placeholder="Institute Id" class="form-control" style="max-width:280px" />*@
                                @Html.TextBoxFor(m => m.INSTID, new { id = "idInstid", oninput = "enterinst()", placeholder = "Institute Id", style = "max-width:280px", @class = "form-control" })
                                <span class="input-group-addon" aria-hidden="true" id="basic-addon2"><i id="instid" class="glyphicon glyphicon-search"></i><img id="idimg" src="~/Content/Images/loading.gif" width="20" style="display:none" /></span>
                            </div>
                            <label id="erINSTID" style="color:red"></label>
                        </div>
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("project NO")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="projectNO" oninput="enterProjectNO()" type="text" class="form-control" value="" placeholder="projectNO" />*@
                                @Html.TextBoxFor(m => m.ProjectNo, new { id = "projectNO", oninput = "enterProjectNO()", type = "text", @class = "form-control", placeholder = "projectNO" })
                                <span class="input-group-addon" aria-hidden="true"><i id="iprojectNO" class="glyphicon glyphicon-search"></i><img id="projimg" src="~/Content/Images/loading.gif" width="20" style="display:none" /></span>
                            </div>
                            <label id="erProjectNO" style="color:red"></label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Commitment NO")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input style="max-width: 280px;" name="bankDate" id="BankDate" type="text" class="form-control " placeholder="Date" aria-describedby="basic-addon2">*@
                                @Html.TextBoxFor(m => m.CommitmentNO, new { style = "max-width: 280px;", name = "", id = "ConsignmentInp", @class = "form-control", placeholder = "Commitment NO", @oninput = "CommitInp()" })
                                <span class="input-group-addon" aria-hidden="true"><i id="iConsignmentInp" class="glyphicon "><img id="consignldr" src="~/Content/Images/loading.gif" width="20" style="display:none" /></i></span>
                            </div>
                            <label id="erConsignment" style="color:red"></label>
                        </div>

                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("voucherNo")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="TransNO" name="TransNO" readonly type="text" class="form-control" value="" placeholder="" />*@
                                @Html.TextBoxFor(m => m.voucherNo, new { id = "voucherNo", name = "voucherNo", oninput = "voucherInput()", type = "text", placeholder = "voucherNo", @class = "form-control" })
                                <span class="input-group-addon" aria-hidden="true"><i id="ivoucherNo" class="glyphicon glyphicon-search"><img id="vouldr" src="~/Content/Images/loading.gif" width="20" style="display:none" /></i></span>
                            </div>
                            <label id="ervoucherNo" style="color:red"></label>
                        </div>

                    </div>
                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Supplier Name")
                            <div class="input-group" style="max-width: 280px;">
                                @**@
                                @Html.HiddenFor(m => m.supplier, new { id = "supplierhid" })
                                @*<input id="supplier" type="text" placeholder="supplier Name" class="form-control" style="max-width:280px" />*@
                                @Html.TextBoxFor(m => m.supplierstr, new { id = "supplier", type = "text", oninput = "suppenter()", placeholder = "supplier Name", @class = "form-control", style = "max-width:280px" })
                                <span class="input-group-addon" aria-hidden="true" id="basic-addon2"><i id="coordnameicon" class="glyphicon glyphicon-search"></i><img id="coordnameimg" src="~/Content/Images/loading.gif" width="20" style="display:none" /></span>
                            </div>
                            @Html.ActionLink("Add Supplier", "Index", "Supplier", null, new { target = "_blank" })
                        </div>
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Date")
                            <div class="input-group" style="max-width: 280px;">
                                @Html.TextBoxFor(m => m.bnkdate, new { id = "BkDate", name = "BkDate", @class = "form-control", @oninput = "dkdateinp()" })
                                @*@Html.TextBoxFor(m => m.TransNO, new { id = "TransNO", name = "TransNO", @readonly = "readonly", type = "text", @class = "form-control", value = "", placeholder = "" })*@
                                <span class="input-group-addon" aria-hidden="true"><i id="" class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                            <label id="erBkDate" style="color:red"></label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Amount")
                            <div class="input-group" style="max-width: 280px;">
                                <span class="input-group-addon" aria-hidden="true"><i id="iprojectNO" class="fa fa-inr"></i></span>
                                @*<input id="Amount" name="Amount" oninput="amountEntered(this)" type="text" class="form-control" value="" placeholder="Amount" />*@
                                @Html.TextBoxFor(m => m.Amount, new { id = "Amount", name = "Amount", oninput = "amountEntered(this)", @class = "form-control", placeholder = "Amount" })
                            </div>
                            <label id="erAmount" style="color:red"></label>
                        </div>
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Cheque Date")
                            <div class="input-group" style="max-width: 280px;">
                                @Html.TextBoxFor(m => m.Cheqdt, new { id = "Cheqdt", name = "Cheqdt", @class = "form-control", @oninput = "Chqinp()" })
                                @*@Html.TextBoxFor(m => m.TransNO, new { id = "TransNO", name = "TransNO", @readonly = "readonly", type = "text", @class = "form-control", value = "", placeholder = "" })*@
                                <span class="input-group-addon" aria-hidden="true"><i id="" class="glyphicon glyphicon-calendar"></i></span>
                            </div>
                            <label id="erChequeDt" style="color:red"></label>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group  col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("VoucherType")
                            @Html.DropDownListFor(m => m.voucherType, Model.voucherTypeList == null ? new List<SelectListItem>() : Model.voucherTypeList, new { @id = "voucherType", @name = "voucherType", @onchange = "changeVoucherType()", @class = "form-control" })
                            @*@Html.DropDownList("VoucherType",
                                                new List<SelectListItem>() {
                                                    new SelectListItem() {Text="Imprest Sanction",Value="8" },
                                    new SelectListItem() {Text="Recoupement",Value="1"},
                                    new SelectListItem() {Text="ChequePayment",Value="2"},
                                    new SelectListItem() {Text="Swipe",Value="3"},
                                    new SelectListItem() {Text="Bank Cash Imprest",Value="4"},
                                    new SelectListItem() {Text="Online Transaction",Value="5"},
                                    new SelectListItem() {Text="ATM",Value="6"},
                                    new SelectListItem() {Text="Cash Payment",Value="7"}
                                }, new { @id = "voucherType", @name = "voucherType", @onchange="changeVoucherType()", @class = "form-control" })*@

                            <label id="erVoucherType" style="color:red"></label>
                        </div>
                        <div class="form-group col-sm-12 col-md-6 col-lg-6" id="Chequesection">
                            @Html.Label("Cheque No")
                            <div class="input-group" style="max-width: 280px;">
                                @*<input id="ChequeNO" name="ChequeNO" type="text" oninput="chequeinp()" class="form-control" value="" placeholder="ChequeNO" />*@
                                @Html.TextBoxFor(m => m.ChequeNO, new { id = "ChequeNO", name = "ChequeNO", type = "text", oninput = "chequeinp()", @class = "form-control", value = "", placeholder = "ChequeNO" })
                                <span class="input-group-addon" aria-hidden="true"><i id="iprojectNO" class="glyphicon glyphicon-edit"></i></span>
                            </div>
                            <label id="erChequeNO" style="color:red"></label>
                        </div>
                    </div>
                    <div class="row">

                    </div>
                    <div id="paymentNarration" class="row">
                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Narration ") &nbsp; <label style="color:sandybrown" id="narrationlimit"></label>
                            @*<textarea id="Narration" name="narration" oninput="NarratinoInput(this)" maxlength="250" class="form-control" rows="6"></textarea>*@
                            @Html.TextAreaFor(m => m.narration, new { id = "Narration", name = "narration", oninput = "NarratinoInput(this)", maxlength = "250", @class = "form-control", rows = "6" })
                            <label id="erNarration" style="color:red"></label>
                        </div>
                        <div class="form-group col-sm-12 col-md-6 col-lg-6">
                            @Html.Label("Remarks") &nbsp; <label id="RemarksLimit" style="color:sandybrown"></label>
                            @*<textarea id="Remarks" name="Remarks" oninput="RemarkInput(this)" maxlength="250" class="form-control" rows="6"></textarea>*@
                            @Html.TextAreaFor(m => m.Remarks, new { id = "Remarks", name = "Remarks", oninput = "RemarkInput(this)", maxlength = "250", @class = "form-control", rows = "6" })
                            <label id="erRemark" style="color:red"></label>
                        </div>
                    </div>

                </div>
            </div>
            <div style="text-align:center;">
                <button type="button" class="btn btn-default" onclick="confirm()">Submit</button>
                <button id="idcancelbtn" type="button" class="btn btn-default" onclick="CancelTran()" style="display:none">Cancel</button>
                <button id="idClearbtn" type="button" class="btn btn-default" onclick="clearfun()">Clear</button>
            </div>
            <br />
        </div>

    </div>
}


<div id="dialog" title="Transaction">
    <p id="msgcontent"></p>
</div>
<div id="msgbox" title="Message">
    <div id="commitedtran">
    </div>
</div>

<div id="VoucherTable" title="Vouchers" style="width:auto">
    <div id="Vou">
    </div>
</div>

<script>
    function dkdateinp() {
        var datestr = $("#BkDate").val();
        var chref = datestr.replace(".", "/");
        chref = chref.replace("-", "/")
        $("#BkDate").val(chref);
    }
    function Chqinp() {
        var datestr = $("#Cheqdt").val();
        var chref = datestr.replace(".", "/");
        chref = chref.replace("-", "/")
        $("#Cheqdt").val(chref);

    }
    function suppenter() {
        $("supplierhid").val('0');
    }
    var voucherNumArray;
    //function CommitInp() {
    //    $("#hiddenComitNO").val('');
    //    ClearLabel("#ervoucherNo");
    //    ClearTestBox("#voucherNo");
    //    ClearTestBox("#Amount");
    //    if ($("#ConsignmentInp").val() == '') {
    //        searchIcon("#iConsignmentInp");
    //        HideLoader("#consignldr");
    //    } else {
    //        removeIcon("#iConsignmentInp");
    //        ShowLoader("#consignldr");
    //    }
    //}
    function clearfun() {
        $("#hiddenProjectNO").val('');
        $("#projectNO").val('');
        $("#Narration").val('');
        $("#Remarks").val('');
        $("#ChequeNO").val('');
        //$("#voucherType").val('');///clear voucherType
        $("#BkDate").val('');
        $("#Amount").val('');
        $("#ProjectDetail").hide(300);
        $("#voucherNo").val('');
        searchIcon("#iprojectNO");
        HideLoader("#projimg");
    }
    function setVouDetails(vdetails) {
        //console.log(vdetails);

        $("#hiddenDisc").val(vdetails.DISC);
        $("#hiddenHead").val(vdetails.HEAD);
        $("#vdHEAD").html(vdetails.HEAD);
        $("#vdPART").html(vdetails.PART);
        $("#BkDate").val(vdetails.Date);
        $("#vdPO").html(vdetails.PONO);
        $("#Amount").val(vdetails.AMOUNT);
        $("#VouDetails").show();
    }
    /////08-03-2017
    function bankaccnoinp() {

        $('#idtransno').html('');

        ClearTestBox("#BkDate");
        $("#VouDetails").hide();
        $("#hiddenAccountNO").val('');
        $("#coordname").val('');
        $("#hiddenINSTID").val('');
        $("#idInstid").val('');
        $("#TransNO").val('');
        $("#voucherNo").val('');
        $("#ConsignmentInp").val('');
        setSerimprestfield();
        ShowLoader("#accimg");
        removeIcon("#accountnoicon");
        if ($("#bankaccno").val() == '') {
            HideLoader("#accimg");
        }
        clearfun();
    }
    function coordnameinp() {
        $("#VouDetails").hide();
        ClearTestBox("#BkDate");
        $("#hiddenAccountNO").val('');
        $('#bankaccno').val('');
        $("#hiddenINSTID").val('');
        $("#idInstid").val('');
        $("#TransNO").val('');
        $('#idtransno').html('');
        $("#voucherNo").val('');
        $("#ConsignmentInp").val('');
        setSerimprestfield();
        ShowLoader("#coordnameimg");
        removeIcon("#coordnameicon");
        if ($('#coordname').val() == '') {
            HideLoader("#coordnameimg");
            searchIcon('#coordnameicon');
        }
        clearfun();
    }

    function generateTransNo() {
        // alert("ddfd");
        $.ajax({
            url: "@Url.Action("GenTransNo", "Trans",new { area=""})",
            type: "POST",
            dataType: "json",
            data: { searchStr: $('#hiddenINSTID').val() },
            success: function (data) {
                //console.log(data);
                if (data.Isfailedobj == "False") {
                    if (data.ermsgo == "success") {

                        $("#idtransno").html(data.Transno);
                        $("#TransNO").val(data.Transno);
                        //$("#idInstid").prop('readonly', true);
                        //// cancel button
                        $("#idcancelbtn").show(300);
                        setTimeout(function () {
                            $("#dialog").dialog('close');
                        }, 300)

                    }
                }
                if (data.Isfailedobj == "True") {
                    if (data.ermsgo == "duplicate") {
                        $("#msgcontent").html("Retry");
                    }
                    if (data.ermsgo == "noACC") {
                        $("#msgcontent").html("No account is Associated with this INSTID");
                    }
                    if (data.ermsgo == "catch") {
                        alert("Catch Block Executed");
                    }
                }
                $('#voucherNo').focus();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert(jqXHR + textStatus + errorThrown);
            }
        })
    }

    function filtercheck() {
        if ($('#filterbool').is(':checked')) { return "true" } else { return "false" }
    }

    function CancelTran() {
        PageRedire.urlr = "@Url.Action("Index","Trans")";
        window.location.href = PageRedire.urlr;
    }
    var PageRedire = {
        urlr: '#'
    }

    function chequeinp() {
        ClearLabel("#erChequeNO");
    }
    function NarratinoInput(para) {
        //console.log(para.value.length);
        $("#narrationlimit").html(250 - para.value.length + " character Remaining");
        ClearLabel("#erNarration");
    }
    function RemarkInput(para) {
        $("#RemarksLimit").html(250 - para.value.length + " character Remaining");
        ClearLabel("#erRemark");
    }
    function voucherInput() {
        $("#VouDetails").hide();
        ClearLabel("#ervoucherNo");
        ClearTestBox("#hiddenVoucherNO");
        ClearTestBox("#hiddenProjectNO");
        ClearTestBox("#Amount");
        ClearTestBox("#BkDate");
        if ($("#voucherNo").val() == '') {
            searchIcon("#ivoucherNo");
            HideLoader("#vouldr");
        } else {
            removeIcon("#ivoucherNo");
            ShowLoader("#vouldr");
        }
    }
    function validatere() {
        var valid = true;
        if ($("#voucherType").val() == null) {
            valid = false;
            $("#erVoucherType").html("Select Voucher Type");
        } else {
            $("#erVoucherType").html("");
        }
        if ($("#hiddenINSTID").val() == '') {
            if (valid != false) {
                valid = false;
            }
            $("#erINSTID").html("Institute Id Not Selected");
        } else {
            $("#erINSTID").html("");
        }
        //if ($("#hiddenProjectNO").val() == '') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erProjectNO").html("ProjectNo Not Selected");
        //} else {
        //    $("#erProjectNO").html("");
        //}
        //if ($("#Narration").val() == '') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erNarration").html("Narration required");
        //} else {
        //    $("#erNarration").html("");
        //}
        //if ($("#Remarks").val() == '') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erRemark").html("Remarks Required");
        //} else {
        //    $("#erRemark").html("");
        //}
        //if ($("#ChequeNO").val() == '' && $("#voucherType").val() == '2') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erChequeNO").html("*Cheque No Required");
        //} else {
        //    $("#erChequeNO").html("");
        //}
        if ($("#BkDate").val() == '') {
            if (valid != false) {
                valid = false;
            }
            $("#erBkDate").html("Date Required");
        } else {
            $("#erBkDate").html("");
        }
        //if ($("#Amount").val() == '') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erAmount").html("*Amount Required");
        //} else {
        //    var amounttered = /^(\d)+$/;
        //    if (amounttered.test($("#Amount").val())) {
        //        $("#erAmount").html("");
        //    }
        //}
        //if ($("#hiddenVoucherNO").val() == '') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#ervoucherNo").html("Voucher no required");
        //} else {
        //    $("#ervoucherNo").html("");
        //}
        //if ($("#hiddenComitNO").val()=='') {
        //    if (valid != false) {
        //        valid = false;
        //    }
        //    $("#erConsignment").html("Commitment no required");
        //} else {
        //    $("#erConsignment").html("");
        //}
        return valid;
    }
    function validate() {
        var ddt=$("#voucherType").val();
        switch ($("#voucherType").val()) {
            case '5':
                var valid = true;
                //if ($("#voucherType").val() == null) {
                //    valid = false;
                //    $("#erVoucherType").html("Select Voucher Type");
                //} else {
                //    $("#erVoucherType").html("");
                //}
                if ($("#hiddenINSTID").val() == '') {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erINSTID").html("Institute Id Not Selected");
                } else {
                    $("#erINSTID").html("");
                }
                //if ($("#hiddenProjectNO").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erProjectNO").html("ProjectNo Not Selected");
                //} else {
                //    $("#erProjectNO").html("");
                //}
                //if ($("#Narration").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erNarration").html("Narration required");
                //} else {
                //    $("#erNarration").html("");
                //}
                //if ($("#Remarks").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erRemark").html("Remarks Required");
                //} else {
                //    $("#erRemark").html("");
                //}
                //var dtreg = /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;
                var dtreg = /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;
                // || (!dtreg.test($('#Cheqdt').val()) && $("#voucherType").val() == '2')
                //if (($("#ChequeNO").val() == '' && $("#voucherType").val() == '2')) {

                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erChequeNO").html("*Cheque No Required");
                //    // $("#erChequeDt").html("*Cheque Date Required");
                //} else {
                //    $("#erChequeNO").html("");
                //    //$("#erChequeDt").html("");
                //}
                if (!(dtreg.test($('#BkDate').val())) || !($('#BkDate').val().length == 10)) {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erBkDate").html("Date Required");
                } else {
                    $("#erBkDate").html("");
                }
                //if (($("#voucherType").val() == '2')) {
                //    if (!(dtreg.test($('#Cheqdt').val())) || !($('#Cheqdt').val().length == 10)) {

                //        if (valid != false) {
                //            valid = false;
                //        }
                //        //$("#erChequeNO").html("*Cheque No Required");
                //        $("#erChequeDt").html("*Cheque Date");
                //    } else {
                //        //$("#erChequeNO").html("");
                //        $("#erChequeDt").html("");
                //    }
                //}
                if ($("#Amount").val() == '') {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erAmount").html("*Amount Required");
                } else {
                    var amounttered = /^(\d)+$/;
                    if (amounttered.test($("#Amount").val())) {
                        $("#erAmount").html("");
                    }
                }
                //if ($("#hiddenVoucherNO").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#ervoucherNo").html("Voucher no required");
                //} else {
                //    $("#ervoucherNo").html("");
                //}
                //if ($("#hiddenComitNO").val()=='') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erConsignment").html("Commitment no required");
                //} else {
                //    $("#erConsignment").html("");
                //}
                return valid;
                break;

            default:
                var valid = true;
                if ($("#voucherType").val() == null) {
                    valid = false;
                    $("#erVoucherType").html("Select Voucher Type");
                } else {
                    $("#erVoucherType").html("");
                }
                if ($("#hiddenINSTID").val() == '') {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erINSTID").html("Institute Id Not Selected");
                } else {
                    $("#erINSTID").html("");
                }
                if ($("#hiddenProjectNO").val() == '') {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erProjectNO").html("ProjectNo Not Selected");
                } else {
                    $("#erProjectNO").html("");
                }
                //if ($("#Narration").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erNarration").html("Narration required");
                //} else {
                //    $("#erNarration").html("");
                //}
                //if ($("#Remarks").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erRemark").html("Remarks Required");
                //} else {
                //    $("#erRemark").html("");
                //}
                //var dtreg = /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;
                var dtreg = /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;
                // || (!dtreg.test($('#Cheqdt').val()) && $("#voucherType").val() == '2')
                if (($("#ChequeNO").val() == '' && $("#voucherType").val() == '2')) {

                    if (valid != false) {
                        valid = false;
                    }
                    $("#erChequeNO").html("*Cheque No Required");
                    // $("#erChequeDt").html("*Cheque Date Required");
                } else {
                    $("#erChequeNO").html("");
                    //$("#erChequeDt").html("");
                }
                if (!(dtreg.test($('#BkDate').val())) || !($('#BkDate').val().length == 10)) {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erBkDate").html("Date Required");
                } else {
                    $("#erBkDate").html("");
                }
                if (($("#voucherType").val() == '2')) {
                    if (!(dtreg.test($('#Cheqdt').val())) || !($('#Cheqdt').val().length == 10)) {

                        if (valid != false) {
                            valid = false;
                        }
                        //$("#erChequeNO").html("*Cheque No Required");
                        $("#erChequeDt").html("*Cheque Date");
                    } else {
                        //$("#erChequeNO").html("");
                        $("#erChequeDt").html("");
                    }
                }
                if ($("#Amount").val() == '') {
                    if (valid != false) {
                        valid = false;
                    }
                    $("#erAmount").html("*Amount Required");
                } else {
                    var amounttered = /^(\d)+$/;
                    if (amounttered.test($("#Amount").val())) {
                        $("#erAmount").html("");
                    }
                }
                //if ($("#hiddenVoucherNO").val() == '') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#ervoucherNo").html("Voucher no required");
                //} else {
                //    $("#ervoucherNo").html("");
                //}
                //if ($("#hiddenComitNO").val()=='') {
                //    if (valid != false) {
                //        valid = false;
                //    }
                //    $("#erConsignment").html("Commitment no required");
                //} else {
                //    $("#erConsignment").html("");
                //}
                return valid;
                break;
        }
        //console.log($("#voucherType").val());
   
    }
    function confirm() {
        if (validate() == true) {

            $.ajax({
                url: "@Url.Action("TransactionPost", "Trans")",
                type: "POST",
                dataType: "json",
                data: $("#TransactionForm").serialize(),
                success: function (data) {
                    //console.log(data);
                    if (data.transdone == "True") {
                        $("#msgbox").dialog('open');
                        $("#commitedtran").empty();
                        $("#commitedtran").append("<p>Saved Successfully </p>" + "<p>Amount: " + $("#Amount").val());
                        PageRedire.urlr = '@Url.Action("Index", "Trans",new { area=""})';
                    }
                    if (data.transdone == "False") {
                        $("#msgbox").dialog('open');
                        if (data.errmsg == "catch") {
                            $("#commitedtran").empty();
                            $("#commitedtran").append("<p>Error in DB(Catch)</p>");
                            PageRedire.urlr = '#';
                        }
                        if (data.errmsg == "NOTRNO") {
                            $("#commitedtran").empty();
                            $("#commitedtran").append("<p>Tran NO Error</p>");

                            PageRedire.urlr = '@Url.Action("Login","Staff",new { area=""})';

                        }
                        if (data.errmsg == "ALCMT") {
                            $("#commitedtran").empty();
                            $("#commitedtran").append("<p>This Tran No is Already exist</p>");
                            PageRedire.urlr = '#';
                        }
                        if (data.errmsg == "NOACAMT") {
                            $("#commitedtran").empty();
                            $("#commitedtran").append("<p>Error Getting Account Detail</p>");
                            PageRedire.urlr = '#';
                        }
                        if (data.errmsg == "AppCatch") {
                            $("#commitedtran").empty();
                            $("#commitedtran").append("<p>AppCatch Error Logged</p>");
                            setTimeout(function () {
                                window.location.href = '@Url.Action("Index", "Trans",new { area=""})'
                            }, 1000);
                        }

                    }
                }
            })
        }
    }
    function amountEntered(domobj) {
        $("#erAmount").html("");
        if (domobj.value != '') {
            var amounttered = /^(\d)+$/;
            if (amounttered.test(domobj.value)) {

            } else {

                $("#erAmount").html("Enter Valid Amount");
            }
        }
        else {
            $("#erAmount").html("");
        }
    }

    var myButtons = {
        "Ok": function () {
            $("#ToJson").val(JSON.stringify(TransactionArray));
            $("#TransNORE").val($("#TransNO").val());
            $("#BkDateRE").val($("#BkDate").val());
            $("#voucherNoRE").val($("#voucherNo").val());
            $("#NarrationRE").val($("#Narration").val());
            $("#RemarksRE").val($("#Remarks").val());
            $("#bankaccnoRE").val($("bankaccno").val());

            //console.log(JSON.stringify(TransactionArray));
            //$("#subRecup").submit();
            $('#VoucherTable').dialog('close');
            $.ajax({
                url: "@Url.Action("SubmitRecup", "Recoup")",
                type: "POST",
                dataType: "JSON",
                data: $('#subRecup').serialize(),//20-03-2017
                success: function (data) {
                    $("#msgbox").dialog('open');
                    $("#commitedtran").empty();
                    if (data.job == 'f') {
                        $("#commitedtran").append("<p>Save failed </p>");
                    } else if (data.job == 's') {
                        $("#commitedtran").append("<p>Saved</p>");
                    }
                    PageRedire.urlr = '@Url.Action("Index", "Trans",new { area=""})';
                    //console.log(data.job);
                }
            });
        },
        "Close": function () {
            $(this).dialog('close');
        }
    };

    function changeVoucherType() {

        if ($("#voucherType").val() == '1' ) {
            if (validatere() == true) {
                $("#erINSTID").html("");
                $.ajax({
                    url: "@Url.Action("Index", "Recoup")",
                    type: "GET",
                    dataType: "HTML",
                    data: { Accno: $("#hiddenAccountNO").val(), vt:$("#voucherType").val() },//20-03-2017
                    success: function (data) {
                        $('#Vou').empty();
                        $('#Vou').html(data);
                        $('#VoucherTable').dialog('option', 'buttons', myButtons);
                        $('#VoucherTable').dialog('open');
                        // console.log(data);
                        PageRedire.urlr = '@Url.Action("Index", "Trans",new { area=""})';
                    }
                });
            } else {
                $("#voucherType").val(2);
            }
        }

    }
    function instidClear() {
        $("#projectNO").val('');
        $("#hiddenINSTID").val('');
        $("#hiddenProjectNO").val('');
        searchIcon("#iprojectNO");
        $("#Narration").val('');
        $("#Remarks").val('');
        $("#ChequeNO").val('');
        $("#BankDate").val('');
        $("#Amount").val('');
        $("#voucherNo").val('');
    }
    function enterinst() {
        $('#idtransno').html('');

        ClearTestBox("#BkDate");
        $("#VouDetails").hide();
        $("#hiddenAccountNO").val('');
        $("#coordname").val('');
        $("#hiddenINSTID").val('');
        $("#bankaccno").val('');
        $("#TransNO").val('');
        $("#voucherNo").val('');
        $("#ConsignmentInp").val('');
        setSerimprestfield();
        $("#erINSTID").html('');
        $("#ProjectDetail").hide();
        ClearTestBox("#BkDate");
        instidClear();
        ShowLoader("#idimg");
        removeIcon("#instid");
        ShowLoader("#idimg");

        if ($("#idInstid").val() == '') {
            HideLoader('#idimg');
            searchIcon("#instid");
        }
    }

    function setInstandAcc(instid, accountno) {
        //alert("inside");
        $('#erAccountno').html('');
        $('#hiddenAccountNO').val(accountno);
        $('#hiddenINSTID').val(instid);
    }
    function setTickimprestfield() {

        removeIcon('#coordnameicon');
        OkIcon('#coordnameicon');
        removeIcon('#accountnoicon');
        OkIcon('#accountnoicon');
        removeIcon('#instid');
        OkIcon('#instid');
        $('#voucherNo').focus();
    }
    function setSerimprestfield() {
        //Ser
        removeIcon('#coordnameicon');
        searchIcon('#coordnameicon');
        removeIcon('#accountnoicon');
        searchIcon('#accountnoicon');
        removeIcon('#instid');
        searchIcon('#instid');
    }
    function enterProjectNO() {
        searchIcon("#iConsignmentInp");
        searchIcon("#ivoucherNo");
        ///ClearTestBox("#Amount");
        //ClearTestBox("#BkDate");
        //$("#hiddenComitNO").val('');
        // $("#voucherNo").val('');
        //$("#hiddenVoucherNO").val('');
        //$("#ConsignmentInp").val('');
        //$("#voucherNo").val('');
        // $("#VouDetails").hide();
        $("erProjectNO").html('');
        //$("#ProjectDetail").hide();
        removeIcon("#iprojectNO");
        $("#hiddenProjectNO").val('');
        ShowLoader("#projimg");
        if ($("#projectNO").val() == '') {
            HideLoader('#projimg');
            searchIcon("#iprojectNO");
        }
    }
    $(function () {
        $('#coordname').focus();
        $("#VoucherTable").dialog({
            autoOpen: false,
            buttons: [
                {
                    text: "Close",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
            closeOnEscape: false,
            draggable: false,
            modal: true,
            width: 'auto'

        });
        searchIcon("#iConsignmentInp");
        if ($("#voucherType").val() == "2") {
            $("#Chequesection").show(200);
        }
        $("#dialog").dialog({
            autoOpen: false,
            buttons: [
                {
                    text: "Close",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
            closeOnEscape: false,
            draggable: false,
            modal: true,
        });
        /////msgbox
        $("#msgbox").dialog({
            autoOpen: false,
            buttons: [
                {
                    text: "Another Transaction",
                    click: function () {
                        var accno = $('#hiddenAccountNO').val();
                        var instid = $('#hiddenINSTID').val();
                        var coorname = $('#coordname').val();
                        var url = '@Url.Action("Index", "Trans", new { area = "" })'
                        url = url + '?state=' + accno + '-' + instid + '-' + coorname;
                        window.location.href = url;
                    }
                },
                {
                    text: "Close",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
            close: function (event, ui) {
                if (PageRedire == null) {
                    PageRedire.urlr = '#';
                }
                if (PageRedire.urlr == null) {
                    PageRedire.urlr = '#';
                }
                window.location.href = PageRedire.urlr;
            },
            closeOnEscape: false,
            draggable: false,
            modal: true,
        });
        ////bankdate
        //$("#BkDate").datepicker({
        //    changeMonth: true,
        //    changeYear: true,
        //    dateFormat: 'dd/mm/yy',
        //    showButtonPanel: false,
        //});
        //$("#Cheqdt").datepicker({
        //    changeMonth: true,
        //    changeYear: true,
        //    dateFormat: 'dd/mm/yy',
        //    showButtonPanel: false,
        //});

        ////autocomplete Coordiname
        $("#coordname").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("coorname", "Trans",new { area = "" })",
                    type: "POST",
                    dataType: "json",
                    data: { coordinatorName: request.term },
                    success: function (data) {
                        //console.log(data);
                        HideLoader("#coordnameimg");
                        if (data.job == "s") {
                            if (data.coordName.length == 0) {
                                searchIcon("#coordnameicon");
                            } else {
                                BottomTriangleIcon("#coordnameicon");
                            }
                        }
                        response($.map(data.coordName, function (item) {
                            return { label: item.name, value: item.name, accno: item.accno, instid: item.instid };
                        }))
                    }
                })
            }, select: function (event, ui) {

                setInstandAcc(ui.item.instid, ui.item.accno);
                $("#bankaccno").val(ui.item.accno);
                $("#idInstid").val(ui.item.instid);
                $("#msgcontent").html("Please Wait..");
                $("#dialog").dialog("open");
                generateTransNo();
                setTickimprestfield();
                $('#voucherNo').focus();
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            //console.log(item);
            return $("<li>")
              .append("<div>" + item.instid + '<br>' + item.label + "<br>" + item.accno + "</div>")
              .appendTo(ul);
        };
        ////autocomplete Coordiname

        //////Autocomplete Account NO
        $("#bankaccno").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("AccountNO", "Trans",new { area = "" })",
                    type: "POST",
                    dataType: "json",
                    data: { AccountNO: request.term },
                    success: function (data) {
                        //setTickimprestfield();
                        HideLoader("#accimg");
                        if (data.job == "s") {
                            if (data.accnolst.length == 0) {
                                searchIcon("#accountnoicon");
                            } else {
                                BottomTriangleIcon("#accountnoicon");
                            }
                        }
                        response($.map(data.accnolst, function (item) {
                            return { label: item.name, value: item.accno, name: item.name, instid: item.instid };
                        }))
                    }
                })
            },
            close: function (event, ui) {
                if ($("#hiddenAccountNO").val() != '') {
                    OkIcon("#accountnoicon");
                } else {
                    searchIcon("#accountnoicon");
                }
            },
            select: function (event, ui) {
                setTickimprestfield();
                setInstandAcc(ui.item.instid, ui.item.value);
                $('#coordname').val(ui.item.name);

                $("#bankaccno").val(ui.item.accno);
                $("#idInstid").val(ui.item.instid);
                $("#msgcontent").html("Please Wait..");
                $("#dialog").dialog("open");
                generateTransNo();
            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            //console.log(item);
            return $("<li>")
              .append("<div>" + item.instid + '<br>' + item.label + "<br>" + item.value + "</div>")
              .appendTo(ul);
        };
        //////AutoComplete Account NO
        //////AutoComplete supplier
        $("#supplier").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("Supplier", "Trans")",
                    type: "POST",
                    dataType: "json",
                    data: { searchStr: request.term },//20-03-2017
                    success: function (data) {


                        response($.map(data, function (item) {
                            return { label: item.Name, value: item.Name, vl: item.Id };
                        }))
                    }
                })
            },
            select: function (event, ui) {

                $("#supplierhid").val(ui.item.vl);

            },

        });
        //////AutoComplete supplier
        ///autoComplete voucherNOUp
        $("#voucherNo").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("VoucherNoUp", "Trans")",
                    type: "POST",
                    dataType: "json",
                    data: { searchStr: request.term, filterbool: filtercheck(), filterstr: $('#filterstring').val(), instid: $('#hiddenINSTID').val() },//20-03-2017
                    success: function (data) {
                        //console.log(data);
                        //console.log(data);
                        HideLoader("#vouldr");
                        if (data.job == "s") {


                            if (data.data.length == 0) {
                                searchIcon("#ivoucherNo");
                            } else {
                                BottomTriangleIcon("#ivoucherNo");
                            }
                        }
                        if (data.job == "fC") {
                            $("#ercoordname").html("select coordinator");
                            $("#voucherNo").val('');
                            searchIcon("#ivoucherNo");
                        }
                        //if (data.job == "fP") {
                        //    $("#erProjectNO").html("Select Project No");
                        //    $("#voucherNo").val('');
                        //    searchIcon("#ivoucherNo");
                        //}
                        response($.map(data.data, function (item) {
                            return { label: item.vouno, value: item.vouno, type: item.ProjectType };
                        }))
                    }
                })
            },
            close: function (event, ui) {
                if ($("#hiddenVoucherNO").val() != '') {
                    OkIcon("#ivoucherNo");
                } else {
                    searchIcon("#ivoucherNo");
                }
            },
            select: function (event, ui) {
                //console.log(ui.item);
                OkIcon("#ivoucherNo");
                $("#hiddenVoucherNO").val(ui.item.value);
                $('#Vou').empty();
                //$('#Vou').html('<p>wait..<p>');
                $.ajax({
                    url: "@Url.Action("VoucherDetails", "Trans")",
                    type: "GET",
                    dataType: "HTML",
                    data: { searchStr: ui.item.value, filterbool: filtercheck(), filterstr: $('#filterstring').val(), instid: $('#hiddenINSTID').val(), Type: ui.item.type },//20-03-2017
                    success: function (data) {
                        $('#Vou').empty();
                        $('#Vou').html(data);
                        $('#VoucherTable').dialog('open');

                        //console.log(data);
                    }
                });
                //setVouDetails(ui.item);

            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            //console.log(item);
            return $("<li>")
              .append("<div>" + 'Voucher No:' + item.label + '<br>' + 'Type:' + item.type + "</div>")
              .appendTo(ul);
        };
        ///autoComplete voucherNOUp


        @*///autoComplete voucherNO
        $("#voucherNo").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("VoucherNO", "Trans")",
                    type: "POST",
                    dataType: "json",
                    data: { searchStr: request.term, projectNO: $("#hiddenProjectNO").val(), commitmentNo: $("#hiddenComitNO").val(), projectStDate: $("#hiddenProjectStartdate").val(), type: $("#hidprojtype").val(), filterbool: filtercheck(), filterstr: $('#filterstring').val() },//20-03-2017
                    success: function (data) {
                        //console.log(data);
                        //console.log(data);
                        HideLoader("#vouldr");
                        if (data.job == "s") {
                            if (data.voulst.length == 0) {
                                searchIcon("#ivoucherNo");
                            } else {
                                BottomTriangleIcon("#ivoucherNo");
                            }
                        }
                        if (data.job == "fC") {
                            $("#erConsignment").html("select commitment no");
                            $("#voucherNo").val('');
                            searchIcon("#ivoucherNo");
                        }
                        if (data.job == "fP") {
                            $("#erProjectNO").html("Select Project No");
                            $("#voucherNo").val('');
                            searchIcon("#ivoucherNo");
                        }
                        response($.map(data.voulst, function (item) {
                            return { label: item.vouno, value: item.vouno, AMOUNT: item.AMOUNT, CQNO: item.CQNO, DISC: item.DISC, Date: item.Date, HEAD: item.HEAD, PART: item.PART, PONO: item.PONO };
                        }))
                    }
                })
            },
            close: function (event, ui) {
                if ($("#hiddenVoucherNO").val() != '') {
                    OkIcon("#ivoucherNo");
                } else {
                    searchIcon("#ivoucherNo");
                }
            },
            select: function (event, ui) {
                //console.log(ui.item);
                OkIcon("#ivoucherNo");
                $("#hiddenVoucherNO").val(ui.item.value);
                setVouDetails(ui.item);

            },
        }).autocomplete("instance")._renderItem = function (ul, item) {
            //console.log(item);
            return $("<li>")
              .append("<div>" + 'Voucher No:' + item.label + '<br>' + 'Date:' + item.Date + '<br>' + 'Rs:' + item.AMOUNT + '<h1></h1>' + "</div>")
              .appendTo(ul);
        };
        ///autoComplete voucherNO*@

        ///autoComplete Consignment NO
        @*$("#ConsignmentInp").autocomplete(
            {
                source: function (request, response) {

                    $.ajax({
                        url: "@Url.Action("ConsignmentNO", "Trans",new { area=""})",
                        type: "POST",
                        dataType: "json",
                        data: { searchStr: request.term, projectStDate: $("#hiddenProjectStartdate").val(), projectNO: $("#hiddenProjectNO").val(), type: $("#hidprojtype").val(), filterbool: filtercheck(), filterstr: $('#filterstring').val() },
                        success: function (data) {
                            ////work
                            HideLoader("#consignldr");
                            if (data.job == "s") {
                                if (data.comList.length == 0) {
                                    searchIcon("#iConsignmentInp");

                                } else {
                                    BottomTriangleIcon("#iConsignmentInp");

                                }
                            }
                            if (data.job == "fI") {
                                $("#erINSTID").html("select Institure Id");
                                $("#ConsignmentInp").val('');
                                searchIcon("#iConsignmentInp");
                            }
                            if (data.job == "fP") {
                                $("#erProjectNO").html("Select Project No");
                                $("#ConsignmentInp").val('');
                                searchIcon("#iConsignmentInp");
                            }
                            if (data.job == "el") {
                                //$("#erProjectNO").html("Select Project No");
                                $("#ConsignmentInp").val('');
                                searchIcon("#iConsignmentInp");
                                $("#msgbox").dialog('open');
                                $("#commitedtran").empty();
                                $("#commitedtran").append("<p>Error Logged</p>");
                            }
                            response($.map(data.comList, function (item) {
                                return { label: item.CommitmentNO, value: item.CommitmentNO };
                            }))
                        }
                    })
                },
                close: function (event, ui) {
                    if ($("#hiddenComitNO").val() != '') {
                        OkIcon("#iConsignmentInp");
                    } else {
                        searchIcon("#iConsignmentInp");
                    }
                },

                select: function (event, ui) {

                    OkIcon("#iConsignmentInp");
                    $("#hiddenComitNO").val(ui.item.value);
                    $("#erConsignment").html('');
                },
            });*@
        ///autocompleteConsignment NO


        ////autoComplete Institute Id
        $("#idInstid").autocomplete(
            {
                source: function (request, response) {

                    $.ajax({
                        url: "@Url.Action("INSTID", "Trans")",
                        type: "POST",
                        dataType: "json",
                        data: { searchStr: request.term },
                        success: function (data) {
                            if (data.message == "success") {
                                $('#idimg').hide();
                                if (data.iirolist.length == 0) {
                                    searchIcon("#instid");
                                } else {
                                    BottomTriangleIcon("#instid");
                                }
                                //console.log(data);
                                response($.map(data.iirolist, function (item) {
                                    return { label: item.instid, value: item.instid, accno: item.accno, name: item.name };
                                }))
                            }
                        }
                    })
                },
                close: function (event, ui) {
                    if ($("#hiddenINSTID").val() != '') {
                        OkIcon("#instid");
                    } else {
                        searchIcon("#instid");
                    }
                },

                select: function (event, ui) {

                    setTickimprestfield();
                    $('#coordname').val(ui.item.name);
                    $("#bankaccno").val(ui.item.accno);
                    setInstandAcc(ui.item.value, ui.item.accno);
                    $("#msgcontent").html("Please Wait..");
                    $("#dialog").dialog("open");
                    generateTransNo();
                },
            }).autocomplete("instance")._renderItem = function (ul, item) {
                //console.log(item);
                return $("<li>")
                  .append("<div>" + item.value + "<br>" + item.name + "<br>" + item.accno + '<br>' + "</div>")
                  .appendTo(ul);
            };
        /////auotcomplete institute ID

        ////autocomplete projectNO
        $("#projectNO").autocomplete(
            {
                source: function (request, response) {
                    $("#hiddenProjectNO").val('');
                    $.ajax({
                        url: "@Url.Action("ProjectNO", "Trans")",
                        type: "POST",
                        dataType: "json",
                        data: { instid: $("#hiddenINSTID").val(), projectno: request.term },
                        success: function (data) {
                            //console.log(data);
                            HideLoader("#projimg");
                            console.log(data.projectlist);
                            if (data.message == "success") {
                                if (data.projectlist != '') {
                                    if (data.projectlist.length == 0) {
                                        searchIcon("#iprojectNO");

                                    } else {
                                        BottomTriangleIcon("#iprojectNO");

                                    }
                                }
                            }
                            if (data.message == "InstidNotSelected") {
                                $("#erAccountno").html("Select Account NO");
                            }
                            response($.map(data.projectlist, function (item) {
                                return { label: item.ProjectNo + ' ' + item.TYPE, value: item.ProjectNo, Type: item.TYPE };
                            }))
                        },
                    })
                },
                select: function (event, ui) {
                    OkIcon("#iprojectNO");
                    console.log(ui.item);
                    $("#hiddenProjectNO").val(ui.item.value);
                    $("#erProjectNO").html("");
                    $("#hiddenprojtype").val(ui.item.Type);
                    //setProjectdetails(ui.item);



                },
                close: function (event, ui) {
                    if ($("#hiddenProjectNO").val() != '') {
                        OkIcon("#iprojectNO");

                    } else {
                        searchIcon("#iprojectNO");
                    }
                },
            });
        /////autocomplete projectN


        //////hidden state
        if ($('#hiddenstate').val() != '') {
            var data = $('#hiddenstate').val();
            var dataarray = data.split('-');
            if (dataarray.length == 1) {
                if (dataarray[0] == 'edit') {
                    alert('edit');
                }
            }
            if (dataarray.length == 3) {
                $('#hiddenAccountNO').val(dataarray[0]);
                $('#hiddenINSTID').val(dataarray[1]);
                $('#coordname').val(dataarray[2]);
                $('#idInstid').val(dataarray[1]);
                $('#bankaccno').val(dataarray[0]);
                removeIcon('#coordnameicon');
                OkIcon('#coordnameicon');
                removeIcon('#accountnoicon');
                OkIcon('#accountnoicon');
                removeIcon('#instid');
                OkIcon('#instid');
                $("#dialog").dialog('open');
                generateTransNo();
                $("#msgcontent").empty();
                $("#msgcontent").append('<p>Please wait</p>');
            }
        }

    });
    function setProjectdetails(details) {
        //console.log(details);
        $("#hiddenProjectStartdate").val(details.STARTDATE);
        $("#NAME").html(details.NAME);
        $("#TITLE").html(details.TITLE);
        $("#STARTDATE").html(details.STARTDATE);
        $("#CLOSEDATE").html(details.CLOSEDATE);

        $("#hidprojtype").val(details.TYPE)
    }
</script>
